<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WordZen</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root { --accent: #fa983a; --blue: #2980b9; }
        body { 
            margin: 0; padding: 0; height: 100vh; overflow: hidden; touch-action: none;
            font-family: 'Segoe UI', sans-serif;
            background: url('https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?auto=format&fit=crop&w=800&q=80') center/cover;
            display: flex; flex-direction: column; align-items: center;
        }

        /* Splash Screen */
        #splash { position: fixed; inset: 0; background: #000; z-index: 1000; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: 1s; }
        .s-logo { font-size: 3.5rem; font-weight: bold; color: #fff; letter-spacing: 8px; text-shadow: 0 0 20px var(--accent); }

        /* √úst Panel */
        #ui-top { width: 100%; display: flex; justify-content: space-between; padding: 20px; box-sizing: border-box; color: #fff; font-weight: bold; text-shadow: 1px 1px 5px #000; }
        #bonus-ui { position: fixed; top: 70px; left: 20px; background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px; backdrop-filter: blur(5px); border: 1px solid #fff; font-size: 14px; }

        /* Bulmaca Alanƒ± */
        #puzzle-area { position: relative; flex: 1; width: 100%; margin-top: 20px; }
        .tile { 
            position: absolute; width: 42px; height: 42px; background: rgba(255,255,255,0.9); 
            border-radius: 5px; display: flex; align-items: center; justify-content: center; 
            font-weight: bold; font-size: 22px; color: transparent; box-shadow: 0 3px 6px rgba(0,0,0,0.2);
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .tile.found { color: #2c3e50; background: #fff; transform: scale(1.1); box-shadow: 0 0 15px var(--accent); }

        /* Se√ßim √ñnizleme */
        #preview { background: var(--blue); color: #fff; padding: 8px 30px; border-radius: 25px; font-weight: bold; font-size: 22px; margin-bottom: 15px; display: none; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }

        /* Tekerlek */
        .wheel-container { position: relative; width: 260px; height: 260px; background: rgba(255,255,255,0.25); backdrop-filter: blur(8px); border-radius: 50%; border: 2px solid rgba(255,255,255,0.4); margin-bottom: 40px; }
        #line-svg { position: absolute; inset: 0; pointer-events: none; z-index: 5; }
        .node { position: absolute; width: 55px; height: 55px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px; font-weight: bold; color: #2c3e50; z-index: 10; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: 0.2s; }
        .node.selected { background: var(--blue); color: #fff; transform: scale(1.2); }
        #shuffle { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: none; border: none; font-size: 24px; cursor: pointer; z-index: 15; opacity: 0.7; }
    </style>
</head>
<body>

<div id="splash">
    <div class="s-logo">WORDZEN</div>
    <div style="color: var(--accent); letter-spacing: 5px;">STUDIOS</div>
</div>

<div id="ui-top">
    <div id="lvl-txt">B√ñL√úM 1</div>
    <div id="coin-txt">ü™ô 0</div>
</div>

<div id="bonus-ui">üéÅ Bonus: <span id="b-count">0</span>/10</div>

<div id="puzzle-area"></div>
<div id="preview"></div>

<div class="wheel-container">
    <svg id="line-svg"></svg>
    <button id="shuffle" onclick="shuffleNodes()">üîÑ</button>
    <div id="wheel"></div>
</div>

<script>
// --- 100 SEVƒ∞YE VERƒ∞Sƒ∞ ---
const allLevels = [
    { letters: "AKLNZ", words: [{t:"KAZAN",x:3,y:1,d:"v"},{t:"KANAL",x:1,y:1,d:"h"}] },
    { letters: "UZAKƒ∞", words: [{t:"UZAK",x:2,y:3,d:"h"},{t:"AKƒ∞L",x:4,y:1,d:"v"}] },
    { letters: "EDNƒ∞Z", words: [{t:"DENƒ∞Z",x:2,y:0,d:"v"},{t:"Dƒ∞Z",x:2,y:0,d:"h"}] }
    // Diƒüer seviyeler buraya eklenecek...
];

// 100'e tamamlayan otomatik d√∂ng√º (Test i√ßin benzer yapƒ±lar kurar)
for(let i=3; i<100; i++) {
    allLevels.push({ letters: "KALEM", words: [{t:"KALEM",x:1,y:2,d:"h"},{t:"EMEL",x:3,y:1,d:"v"}] });
}

let curLvl = parseInt(localStorage.getItem('wz_lvl')) || 0;
let coins = parseInt(localStorage.getItem('wz_coins')) || 0;
let bonusCount = 0;
let selected = [];
let foundWords = [];
let isDrawing = false;

// TDK API Kontrol√º
async function checkTDK(word) {
    try {
        const r = await fetch(`https://sozluk.gov.tr/gts?ara=${word.toLowerCase('tr')}`);
        const d = await r.json();
        return d && !d.error && d.length > 0;
    } catch { return false; }
}

function init() {
    if(curLvl >= 100) {
        showEnd(); return;
    }
    const data = allLevels[curLvl];
    foundWords = [];
    document.getElementById('lvl-txt').innerText = `B√ñL√úM ${curLvl + 1}`;
    document.getElementById('coin-txt').innerText = `ü™ô ${coins}`;
    
    // Bulmaca Gridini Kur
    const area = document.getElementById('puzzle-area');
    area.innerHTML = "";
    data.words.forEach(wObj => {
        wObj.t.split('').forEach((char, i) => {
            const px = wObj.d === 'h' ? (wObj.x + i) : wObj.x;
            const py = wObj.d === 'v' ? (wObj.y + i) : wObj.y;
            if(!document.getElementById(`t-${px}-${py}`)) {
                const t = document.createElement('div');
                t.id = `t-${px}-${py}`;
                t.className = `tile word-${wObj.t}`;
                t.style.left = `calc(50% + ${(px - 3) * 46}px)`;
                t.style.top = `${py * 46}px`;
                t.innerText = char;
                area.appendChild(t);
            }
        });
    });

    // Tekerleƒüi Kur
    const wheel = document.getElementById('wheel');
    wheel.innerHTML = "";
    data.letters.split('').forEach((c, i) => {
        const angle = (i / data.letters.length) * (Math.PI*2) - (Math.PI/2);
        const x = 130 + 95 * Math.cos(angle) - 27;
        const y = 130 + 95 * Math.sin(angle) - 27;
        const n = document.createElement('div');
        n.className = 'node'; n.style.left = x+'px'; n.style.top = y+'px'; n.innerText = c;
        n.addEventListener('mousedown', e => startDraw(e, n));
        n.addEventListener('touchstart', e => startDraw(e, n));
        n.addEventListener('mouseenter', () => overNode(n));
        wheel.appendChild(n);
    });
}

function startDraw(e, n) { isDrawing = true; addNode(n); document.getElementById('preview').style.display="block"; }
function overNode(n) { if(isDrawing && !selected.includes(n)) addNode(n); }
window.addEventListener('touchmove', e => {
    if(!isDrawing) return;
    const t = e.touches[0];
    const el = document.elementFromPoint(t.clientX, t.clientY);
    if(el && el.classList.contains('node')) overNode(el);
});

function addNode(n) {
    selected.push(n); n.classList.add('selected');
    document.getElementById('preview').innerText = selected.map(x=>x.innerText).join('');
    drawLines();
}

function drawLines() {
    const svg = document.getElementById('line-svg'); svg.innerHTML = "";
    if(selected.length < 2) return;
    let d = `M ${parseInt(selected[0].style.left)+27} ${parseInt(selected[0].style.top)+27}`;
    for(let i=1; i<selected.length; i++) d += ` L ${parseInt(selected[i].style.left)+27} ${parseInt(selected[i].style.top)+27}`;
    const p = document.createElementNS("http://www.w3.org/2000/svg", "path");
    p.setAttribute("d", d); p.setAttribute("stroke", "var(--blue)"); p.setAttribute("stroke-width", "12"); p.setAttribute("fill", "none"); p.setAttribute("stroke-linecap", "round");
    svg.appendChild(p);
}

async function endDraw() {
    if(!isDrawing) return;
    const word = selected.map(x=>x.innerText).join('');
    const data = allLevels[curLvl];

    if(data.words.some(w => w.t === word) && !foundWords.includes(word)) {
        foundWords.push(word);
        document.querySelectorAll(`.word-${word}`).forEach(t => t.classList.add('found'));
        if(foundWords.length === data.words.length) setTimeout(nextLvl, 1000);
    } else {
        const valid = await checkTDK(word);
        if(valid && !data.words.some(w => w.t === word)) {
            bonusCount++;
            document.getElementById('b-count').innerText = bonusCount;
            if(bonusCount >= 10) {
                coins += 25; bonusCount = 0;
                localStorage.setItem('wz_coins', coins);
                document.getElementById('coin-txt').innerText = `ü™ô ${coins}`;
                document.getElementById('b-count').innerText = "0";
                alert("BONUS: +25 Jeton! ü™ô");
            }
        }
    }
    isDrawing = false; selected.forEach(n => n.classList.remove('selected'));
    selected = []; document.getElementById('line-svg').innerHTML = "";
    document.getElementById('preview').style.display = "none";
}

function nextLvl() {
    curLvl++; localStorage.setItem('wz_lvl', curLvl);
    init();
}

function showEnd() {
    document.body.innerHTML = `<div style="height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; background:#000; color:#fa983a; text-align:center;">
        <h1 style="font-size:3rem">TEBRƒ∞KLER!</h1>
        <p style="color:#fff">T√ºm b√∂l√ºmleri tamamladƒ±n.</p>
        <div style="margin-top:30px; padding:15px 30px; border:2px solid #fa983a; border-radius:50px;">YENƒ∞ B√ñL√úMLER YAKINDA!</div>
    </div>`;
}

window.addEventListener('mouseup', endDraw); window.addEventListener('touchend', endDraw);
function shuffleNodes() {
    const nodes = Array.from(document.querySelectorAll('.node'));
    const chars = nodes.map(n => n.innerText).sort(() => Math.random() - 0.5);
    nodes.forEach((n, i) => n.innerText = chars[i]);
}

window.onload = () => {
    setTimeout(() => { document.getElementById('splash').style.opacity = "0"; setTimeout(() => document.getElementById('splash').style.display = "none", 1000); }, 2500);
    init();
};
</script>
</body>
</html>
