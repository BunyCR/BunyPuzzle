<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WordZen</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root { --accent: #fa983a; --bg: #000; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; display: flex; flex-direction: column; align-items: center; height: 100vh; }
        
        /* Splash Screen */
        #splash { position: fixed; inset: 0; background: #000; z-index: 1000; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: 1s; }
        .s-logo { font-size: 3.5rem; font-weight: bold; letter-spacing: 8px; text-shadow: 0 0 20px var(--accent); animation: pulse 2s infinite; }
        
        /* UI */
        #top-bar { width: 100%; display: flex; justify-content: space-between; padding: 15px 25px; box-sizing: border-box; font-size: 1.2rem; font-weight: bold; }
        #bonus-ui { position: fixed; top: 70px; left: 20px; background: rgba(250, 152, 58, 0.2); padding: 8px 15px; border-radius: 20px; border: 1px solid var(--accent); font-size: 0.9rem; }

        /* Kelime Tablosu */
        #grid { flex: 1; display: grid; grid-template-columns: repeat(6, 45px); gap: 8px; justify-content: center; align-content: center; }
        .tile { width: 45px; height: 45px; background: rgba(255,255,255,0.05); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 22px; color: transparent; transition: 0.4s; border: 1px solid rgba(255,255,255,0.1); }
        .tile.active { background: #fff; color: #000; transform: scale(1.1); box-shadow: 0 0 15px #fff; border: none; }

        /* √ñnizleme */
        #preview { height: 45px; background: var(--accent); padding: 5px 30px; border-radius: 25px; font-weight: bold; font-size: 24px; margin-bottom: 20px; display: none; box-shadow: 0 0 20px var(--accent); }

        /* Tekerlek */
        .wheel-box { position: relative; width: 280px; height: 280px; margin-bottom: 50px; }
        #line-svg { position: absolute; inset: 0; pointer-events: none; z-index: 5; }
        .node { position: absolute; width: 60px; height: 60px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px; font-weight: bold; color: #000; z-index: 10; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .node.selected { background: var(--accent); color: #fff; transform: scale(1.2); }
        #shuffle { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255,255,255,0.1); border: 2px solid #fff; color: #fff; border-radius: 50%; width: 50px; height: 50px; font-size: 20px; cursor: pointer; z-index: 15; }
    </style>
</head>
<body>

<div id="splash">
    <div class="s-logo">WORDZEN</div>
    <div style="color: var(--accent); letter-spacing: 4px;">STUDIOS</div>
</div>

<div id="top-bar">
    <div id="lvl-txt">Seviye: 1</div>
    <div id="coin-txt">ü™ô 0</div>
</div>

<div id="bonus-ui">üéÅ Bonus: <span id="b-count">0</span>/10</div>

<div id="grid"></div>
<div id="preview"></div>

<div class="wheel-box">
    <svg id="line-svg"></svg>
    <button id="shuffle" onclick="shuffle()">üîÑ</button>
    <div id="wheel"></div>
</div>

<script>
// --- 100 SEVƒ∞YE ≈ûABLONU ---
// Burayƒ± 100'e kadar doldurabilirsin.
const allLevels = [
    { letters: "AKLNZ", words: ["KAZAN", "KAZ", "NAL"] },
    { letters: "ETKƒ∞L", words: ["TEKƒ∞L", "ETƒ∞K", "Kƒ∞TLE"] },
    { letters: "ASLAN", words: ["ASLAN", "ASAL", "SALA", "NAL"] },
    // √ñrnek: { letters: "ABCDE", words: ["..."] },
];

let curLvl = parseInt(localStorage.getItem('wz_lvl')) || 0;
let coins = parseInt(localStorage.getItem('wz_coins')) || 0;
let bonusList = [];
let selectedNodes = [];
let found = [];
let drawing = false;

async function checkTDK(word) {
    try {
        const r = await fetch(`https://sozluk.gov.tr/gts?ara=${word.toLowerCase('tr')}`);
        const d = await r.json();
        return d && !d.error && d.length > 0;
    } catch { return false; }
}

function initGame() {
    if(curLvl >= 100 || curLvl >= allLevels.length) {
        document.body.innerHTML = "<h1 style='margin-top:100px; text-align:center'>YENƒ∞ SEVƒ∞YELER YAKINDA!</h1>";
        return;
    }
    const data = allLevels[curLvl];
    found = [];
    document.getElementById('lvl-txt').innerText = `Seviye: ${curLvl + 1}`;
    document.getElementById('coin-txt').innerText = `ü™ô ${coins}`;
    
    const g = document.getElementById('grid'); g.innerHTML = "";
    data.words.forEach(w => {
        w.split('').forEach(c => {
            const t = document.createElement('div');
            t.className = `tile t-${w}`; t.innerText = c;
            g.appendChild(t);
        });
    });

    const w = document.getElementById('wheel'); w.innerHTML = "";
    data.letters.split('').forEach((c, i) => {
        const a = (i / data.letters.length) * (Math.PI*2) - (Math.PI/2);
        const x = 140 + 100 * Math.cos(a) - 30;
        const y = 140 + 100 * Math.sin(a) - 30;
        const n = document.createElement('div');
        n.className = 'node'; n.style.left = x+'px'; n.style.top = y+'px'; n.innerText = c;
        n.addEventListener('mousedown', (e) => start(e, n));
        n.addEventListener('touchstart', (e) => start(e, n));
        n.addEventListener('mouseenter', () => over(n));
        w.appendChild(n);
    });
}

function start(e, n) { drawing = true; select(n); document.getElementById('preview').style.display="block"; }
function over(n) { if(drawing && !selectedNodes.includes(n)) select(n); }
window.addEventListener('touchmove', e => {
    if(!drawing) return;
    const t = e.touches[0];
    const el = document.elementFromPoint(t.clientX, t.clientY);
    if(el && el.classList.contains('node')) over(el);
});

function select(n) {
    selectedNodes.push(n); n.classList.add('selected');
    document.getElementById('preview').innerText = selectedNodes.map(x=>x.innerText).join('');
    renderLines();
}

function renderLines() {
    const s = document.getElementById('line-svg'); s.innerHTML = "";
    if(selectedNodes.length < 2) return;
    let path = `M ${parseInt(selectedNodes[0].style.left)+30} ${parseInt(selectedNodes[0].style.top)+30}`;
    for(let i=1; i<selectedNodes.length; i++) {
        path += ` L ${parseInt(selectedNodes[i].style.left)+30} ${parseInt(selectedNodes[i].style.top)+30}`;
    }
    const l = document.createElementNS("http://www.w3.org/2000/svg", "path");
    l.setAttribute("d", path); l.setAttribute("stroke", "var(--accent)"); l.setAttribute("stroke-width", "10"); l.setAttribute("fill", "none"); l.setAttribute("stroke-linecap", "round");
    s.appendChild(l);
}

async function end() {
    if(!drawing) return;
    const word = selectedNodes.map(x=>x.innerText).join('');
    const data = allLevels[curLvl];

    if(data.words.includes(word) && !found.includes(word)) {
        found.push(word);
        document.querySelectorAll(`.t-${word}`).forEach(t => t.classList.add('active'));
        if(found.length === data.words.length) {
            setTimeout(() => { curLvl++; localStorage.setItem('wz_lvl', curLvl); initGame(); }, 1000);
        }
    } else {
        const ok = await checkTDK(word);
        if(ok && !bonusList.includes(word) && !data.words.includes(word)) {
            bonusList.push(word);
            document.getElementById('b-count').innerText = bonusList.length;
            if(bonusList.length >= 10) {
                coins += 25; bonusList = [];
                localStorage.setItem('wz_coins', coins);
                document.getElementById('coin-txt').innerText = `ü™ô ${coins}`;
                document.getElementById('b-count').innerText = "0";
                alert("WORDZEN BONUS: +25 Jeton!");
            }
        }
    }
    drawing = false; selectedNodes.forEach(n => n.classList.remove('selected'));
    selectedNodes = []; document.getElementById('line-svg').innerHTML = "";
    document.getElementById('preview').style.display = "none";
}

window.addEventListener('mouseup', end); window.addEventListener('touchend', end);

function shuffle() {
    const ns = Array.from(document.querySelectorAll('.node'));
    const cs = ns.map(n => n.innerText).sort(() => Math.random() - 0.5);
    ns.forEach((n, i) => n.innerText = cs[i]);
}

window.onload = () => {
    setTimeout(() => {
        document.getElementById('splash').style.opacity = "0";
        setTimeout(() => document.getElementById('splash').style.display = "none", 1000);
    }, 2500);
    initGame();
};

if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
</script>
</body>
</html>
